<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯­æ–‡æœŸæœ«å†²åˆº (6å¤©å®Œæˆç‰ˆ)</title>
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        :root {
            /* å†²åˆºæ¨¡å¼ä½¿ç”¨æ›´é†’ç›®çš„çº¢è‰²/æ©™è‰²è°ƒ */
            --primary: #ea580c; 
            --primary-hover: #c2410c;
            --bg: #fff7ed;
            --card: #ffffff;
            --text: #431407;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: var(--card);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 800px;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        header { text-align: center; margin-bottom: 10px; }
        h1 { color: var(--primary); font-size: 2rem; margin-bottom: 10px; }
        .subtitle { color: #9a3412; font-size: 0.95rem; font-weight: bold; }

        .setup-panel {
            border: 2px dashed #fdba74;
            border-radius: 12px;
            padding: 20px;
            background: #fff;
            transition: all 0.3s;
        }

        .day-selector-area {
            background: #ffedd5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #fed7aa;
        }

        .day-select {
            width: 100%;
            padding: 12px;
            font-size: 1.1rem;
            border: 2px solid #f97316;
            border-radius: 8px;
            color: #c2410c;
            background: white;
            cursor: pointer;
            font-weight: bold;
        }

        .preview-box {
            font-size: 0.9rem;
            color: #666;
            margin-top: 10px;
            padding: 10px;
            background: rgba(255,255,255,0.6);
            border-radius: 5px;
            max-height: 100px;
            overflow-y: auto;
        }

        .settings-row {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .setting-group { display: flex; align-items: center; gap: 8px; }
        
        .main-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.3rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s, background 0.2s;
            box-shadow: 0 4px 15px rgba(234, 88, 12, 0.3);
        }
        .main-btn:hover { background: var(--primary-hover); transform: translateY(-2px); }

        /* Running Mode UI */
        .running-ui { display: none; text-align: center; padding: 20px 0; }
        
        .status-badge {
            display: inline-block;
            background: #ffedd5;
            color: var(--primary);
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .big-word-display {
            font-size: 4rem;
            font-weight: 800;
            color: var(--text);
            margin: 30px 0;
            min-height: 80px;
            font-family: "KaiTi", "æ¥·ä½“", serif;
        }

        .progress-bar {
            height: 10px;
            background: #fee2e2;
            border-radius: 5px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s;
        }

        .control-btns { display: flex; justify-content: center; gap: 15px; }
        .control-btn {
            padding: 10px 24px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        .btn-pause { background: #fef9c3; color: #b45309; border: 1px solid #fde047; }
        .btn-stop { background: #fee2e2; color: #b91c1c; border: 1px solid #fecaca; }

        .answer-list {
            margin-top: 30px;
            text-align: left;
            background: #fff7ed;
            padding: 20px;
            border-radius: 12px;
            display: none;
        }
        .answer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
        }
        .answer-item {
            background: white;
            padding: 12px 5px;
            border-radius: 8px;
            text-align: center;
            font-size: 1.1rem;
            font-weight: bold;
            color: #c2410c;
            border: 1px solid #fdba74;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .expand-toggle {
            text-align: center;
            color: #999;
            cursor: pointer;
            font-size: 0.8rem;
            margin-top: 10px;
            text-decoration: underline;
        }
        #customInputArea { display: none; margin-top: 10px;}
        textarea { width: 100%; height: 100px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸ”¥ è¯­æ–‡æœŸæœ«å†²åˆº (6å¤©å®Œæˆ)</h1>
        <p class="subtitle">å…± 188 ä¸ªè¯è¯­ | æ¯æ—¥çº¦ 32 ä¸ª | è€ƒå‰åŠ æ²¹ï¼</p>
    </header>

    <div id="setupArea" class="setup-panel">
        
        <div class="day-selector-area">
            <label style="display:block; margin-bottom:8px; font-weight:bold; color:#c2410c;">ğŸ“… è¯·é€‰æ‹©å†²åˆºè¿›åº¦ï¼š</label>
            <select id="daySelect" class="day-select" onchange="previewWords()">
                </select>
            <div class="preview-box" id="wordPreview">
                </div>
        </div>

        <div class="settings-row">
            <div class="setting-group">
                <label>æ¯è¯æœ—è¯»:</label>
                <select id="repeatCount">
                    <option value="1">1æ¬¡</option>
                    <option value="2" selected>2æ¬¡</option>
                    <option value="3">3æ¬¡</option>
                </select>
            </div>
            <div class="setting-group">
                <label>å†™å­—æ—¶é—´:</label>
                <select id="waitTime">
                    <option value="5">5ç§’</option>
                    <option value="8" selected>8ç§’</option>
                    <option value="12">12ç§’</option>
                    <option value="15">15ç§’</option>
                </select>
            </div>
        </div>

        <button class="main-btn" onclick="initDictation()">ğŸš€ å¼€å§‹ä»Šæ—¥å†²åˆº</button>

        <div class="expand-toggle" onclick="toggleCustomArea()">+ æˆ‘æƒ³è‡ªå·±ç²˜è´´å…¶ä»–è¯è¯­/ä¸Šä¼ æ–‡ä»¶</div>
        <div id="customInputArea">
             <p style="font-size:0.8rem; color:#666; margin-bottom:5px;">ç²˜è´´æ–°è¯åï¼Œä¸Šæ–¹â€œé€‰æ‹©è¿›åº¦â€å°†å¤±æ•ˆï¼Œæ”¹ä¸ºå¬å†™ä¸‹æ–¹å…¨éƒ¨å†…å®¹ã€‚</p>
             <textarea id="customWordInput" placeholder="åœ¨æ­¤å¤„ç²˜è´´ä¸´æ—¶æƒ³å¬å†™çš„è¯è¯­..."></textarea>
             <input type="file" accept="application/pdf" onchange="handlePdfUpload(event)" style="margin-top:5px;">
             <div id="ocrStatus" style="font-size:0.8rem; color:green;"></div>
        </div>
    </div>

    <div id="runningArea" class="running-ui">
        <div class="status-badge" id="progressText">è¿›åº¦: 0 / 0</div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="big-word-display" id="wordDisplay">å‡†å¤‡å¥½äº†å—ï¼Ÿ</div>
        <div style="color: #64748b; margin-bottom: 20px;" id="statusMsg">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹</div>

        <div class="control-btns">
            <button class="control-btn btn-pause" id="pauseBtn" onclick="togglePause()">æš‚åœ</button>
            <button class="control-btn btn-stop" onclick="stopDictation()">ç»“æŸ</button>
        </div>

        <div class="answer-list" id="answerList"></div>
    </div>
</div>

<script>
    // --- 1. å†…ç½®è¯åº“ (188ä¸ªè¯è¯­) ---
    const rawData = "é•¶åµŒã€é•œåŒ£ã€ä»°æ…•ã€çŸ®å°ã€æ’­ç§ã€å©å’ã€å˜±å’ã€æ¦¨èœã€ç®©ç­ã€çº ç¼ ã€æ±›æœŸã€é—´éš”ã€æ‡’æƒ°ã€å¹³è¡¡ã€åè°ƒã€å¿ è‡£ã€æ‰¿è¯ºã€å¾—ç½ªã€èƒ†æ€¯ã€æ‹’ç»ã€è†æ£˜ã€ä¿¯è§†ã€ä¸€æšé‡‘å¸ã€é‚®ç­’ã€èµ¤é“ã€ä¾µç•¥ã€å…šç« ã€å¦¨ç¢ã€éšè”½ã€é™·é˜±ã€æ‹å¼¯ã€é…¬è°¢ã€å®å˜±ã€å´©å¡Œã€ç„¦è™‘ã€å®£èª“ã€è°è¯ã€å»¶æœŸã€ä¸€è¾†ã€åè¶Ÿã€æ‰˜ä¸¾ã€é•¿è¾ˆã€å®¶ç¥­ã€ä¹ƒç¿ã€æƒå¼ºå‡Œå¼±ã€æ‹˜ç•™ã€æ‚²å“€ã€ä¸Šåä¸‹æ³»ã€æ½œä¼ã€è„±èƒæ¢éª¨ã€å¦‚å±¥è–„è¢«ã€æ¯ç­ã€é‡‘ç¢§è¾‰ç…Œã€å®«æ®¿ã€ä¸˜é™µã€é¥±è§ˆã€å®ä¼Ÿã€é—¯è¡ã€ä¼ ç»Ÿã€å¼€é”€ã€æ‹æ‘„ã€ç…¤ç‚­ã€ç—…èŒã€å®‰æ­‡ã€ç‹­çª„ã€å‹‰å¼ºã€èš•ä¸ã€å¸­å­ã€é™ªä¼´ã€ç¤¼æ¯•ã€åˆ©ç›Šã€å‘æ„ã€å¯ºåº™ã€æ„ˆåˆã€ç¬é—´ã€ç‹¼è—‰ã€ä¹¦ç±ã€å¯‚é™ã€æŸå¤±ã€ç‰ºç‰²ã€æé†’ã€ä¼¤å¿ƒã€çƒ­æ³ªç›ˆçœ¶ã€è¿è½¬ã€å‰å®³ã€ç»å†ã€é¼»å­ã€æ¿€åŠ±ã€å¿…é¡»ã€éœ€è¦ã€é’¦ä½©ã€å€Ÿé’±ã€é“ºå«ã€æ„¤æ€’ã€åé¦ˆã€è´¡çŒ®ã€æ ¸æ½œè‰‡ã€é’™ç‰‡ã€å¥–åŠ±ã€è•´å«ã€éƒé—·ã€åŒå¼•å·ã€æ›¾ç»ã€å‡ºç¥å…¥åŒ–ã€è¯±å‘ã€é“è°¢ã€å½»åº•ã€è„±æ‰ã€å®‰é€¸ã€ç¯®çƒã€èµ”å¿ã€è€ƒè¯•ã€åŠŸå¤«ã€èŒ‚ç››ã€å†å²ã€å®½å®¹ã€è¶³æ™ºå¤šè°‹ã€çŒè±¹ã€çˆ†è£‚ã€è„¾æ°”ã€æ·å¾„ã€é¼“åŠ±ã€åˆ†æã€è‡ªè´£ã€ç§‰å…¬æ‰§æ³•ã€å¥åº·ã€è®­æ–¥ã€æ¸…æ™°ã€æŠ¥æ•ˆã€æ´¾é€ã€æµ®ç°ã€å›´ç»•ã€å†µä¸”ã€ç”šè‡³ã€å‚å¤´ä¸§æ°”ã€ä¸¥è°¨ã€å®½å¤§ã€æœºæ¢°ã€è´£å¤‡ã€ç¨€ç½•ã€ç‹®å­ã€ç…¤å±‘ã€ä¸å±‘ã€çå±‘ã€æ‚²ä¼¤ã€èµ«èµ«æœ‰åã€å¿ƒæ—·ç¥æ€¡ã€è”ºç›¸å¦‚ã€å»‰é¢‡ã€æ´¥æ´¥æœ‰å‘³ã€ç•é¦–ç•å°¾ã€åƒè¾›ä¸‡è‹¦ã€åƒè¨€ä¸‡è¯­ã€éš†é‡ã€æ‚ ç„¶ã€é¿éš¾ã€çæƒœã€é¦™çš‚ã€æµ‡æ°´ã€éƒŠå¤–ã€å¸‚éƒŠã€è§„åˆ’ã€å¼ºè¿«ã€è°¦è™šã€å£ç½©ã€é®ä½ã€é¸µé¸Ÿã€é»æ˜ã€çšæ´ã€å±äºã€èººä¸‹ã€èˆ¬é…ã€å‹’ç´¢ã€å‹¤åŠ³ã€æ‘‡æ™ƒã€ç²—ç³™ã€å€¼å¾—ã€äººç±»ã€ç”»çœ‰ã€è’å”ã€å‹¤å¥‹ã€ä¸å¯æ€è®®";
    
    // è½¬æ¢ä¸ºæ•°ç»„
    const allWords = rawData.split(/[ã€\s]+/).filter(w => w.length > 0);
    
    // *** å…³é”®ä¿®æ”¹ï¼šæ¯å¤©å¬å†™æ•°é‡è®¾ç½®ä¸º 32 ä¸ªï¼Œä»¥ä¾¿åœ¨ 6 å¤©å†…å®Œæˆ ***
    // 188 / 6 â‰ˆ 31.3
    const WORDS_PER_DAY = 32;

    // --- Global Variables ---
    let currentSessionList = [];
    let currentIndex = 0;
    let isRunning = false;
    let isPaused = false;
    let synth = window.speechSynthesis;
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    // --- Initialization ---
    window.onload = function() {
        initDaySelector();
    }

    function initDaySelector() {
        const select = document.getElementById('daySelect');
        const totalDays = Math.ceil(allWords.length / WORDS_PER_DAY);
        
        select.innerHTML = '';
        for (let i = 0; i < totalDays; i++) {
            const start = i * WORDS_PER_DAY + 1;
            const end = Math.min((i + 1) * WORDS_PER_DAY, allWords.length);
            const count = end - start + 1;
            
            const option = document.createElement('option');
            option.value = i;
            option.text = `ğŸ“… ç¬¬ ${i + 1} å¤© (è¯è¯­ ${start}-${end}) [å…±${count}ä¸ª]`;
            select.appendChild(option);
        }
        previewWords();
    }

    function previewWords() {
        const dayIndex = document.getElementById('daySelect').value;
        const start = dayIndex * WORDS_PER_DAY;
        const end = start + WORDS_PER_DAY;
        const words = allWords.slice(start, end);
        
        document.getElementById('wordPreview').innerText = "åŒ…å«ï¼š " + words.join("ã€");
    }

    function toggleCustomArea() {
        const area = document.getElementById('customInputArea');
        area.style.display = area.style.display === 'none' ? 'block' : 'none';
    }

    // --- Logic for Dictation ---

    function initDictation() {
        const customInput = document.getElementById('customWordInput').value.trim();
        
        if (customInput.length > 0) {
            currentSessionList = processTextToWords(customInput);
            if(currentSessionList.length === 0) {
                alert("æœªæ£€æµ‹åˆ°æœ‰æ•ˆä¸­æ–‡è¯è¯­ï¼Œè¯·æ£€æŸ¥è¾“å…¥ã€‚");
                return;
            }
        } else {
            const dayIndex = parseInt(document.getElementById('daySelect').value);
            const start = dayIndex * WORDS_PER_DAY;
            const end = start + WORDS_PER_DAY;
            currentSessionList = allWords.slice(start, end);
        }

        // åˆ‡æ¢ç•Œé¢
        document.getElementById('setupArea').style.display = 'none';
        document.getElementById('runningArea').style.display = 'block';
        document.getElementById('answerList').style.display = 'none';
        document.getElementById('answerList').innerHTML = '';

        startSession();
    }

    function processTextToWords(text) {
        const extracted = text.match(/[\u4e00-\u9fa5]+/g);
        if (!extracted) return [];
        return extracted.filter(w => w.length >= 1);
    }

    // --- Core Dictation Loop ---

    async function startSession() {
        isRunning = true;
        isPaused = false;
        currentIndex = 0;
        document.getElementById('pauseBtn').innerText = 'æš‚åœ';
        
        const display = document.getElementById('wordDisplay');
        const status = document.getElementById('statusMsg');
        
        // å€’è®¡æ—¶
        for(let i=3; i>0; i--) {
            display.innerText = i;
            await sleep(1000);
        }

        while (currentIndex < currentSessionList.length && isRunning) {
            updateProgress();
            await checkPause();
            if (!isRunning) break;

            const word = currentSessionList[currentIndex];
            
            // å¬å†™è¿‡ç¨‹
            display.innerText = `ç¬¬ ${currentIndex + 1} ä¸ª`;
            display.style.color = '#431407';
            status.innerText = 'æ­£åœ¨æœ—è¯»...';

            const repeat = parseInt(document.getElementById('repeatCount').value);

            for (let r=0; r < repeat; r++) {
                await checkPause(); 
                if (!isRunning) break;
                
                await speakWord(word);
                
                if (r < repeat - 1) {
                    await sleep(1500); 
                }
            }

            // å†™å­—ç­‰å¾…æ—¶é—´
            if (!isRunning) break;
            status.innerText = 'è¯·ä¹¦å†™...';
            display.style.color = '#ccc'; 
            
            const waitTime = parseInt(document.getElementById('waitTime').value) * 10; 
            for(let t=0; t<waitTime; t++) { 
                await checkPause();
                if (!isRunning) break;
                await sleep(100);
            }

            currentIndex++;
        }

        if (isRunning) {
            finishDictation();
        }
    }

    function speakWord(text) {
        return new Promise((resolve) => {
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'zh-CN'; 
            u.rate = 0.9; 
            
            u.onend = resolve;
            u.onerror = (e) => {
                console.error("Speech error", e);
                resolve(); 
            };
            synth.speak(u);
        });
    }

    function updateProgress() {
        const total = currentSessionList.length;
        const current = currentIndex + 1;
        document.getElementById('progressText').innerText = `è¿›åº¦: ${currentIndex} / ${total}`;
        const pct = (currentIndex / total) * 100;
        document.getElementById('progressFill').style.width = `${pct}%`;
    }

    async function checkPause() {
        while (isPaused && isRunning) {
            await sleep(200);
        }
    }

    function togglePause() {
        isPaused = !isPaused;
        const btn = document.getElementById('pauseBtn');
        if (isPaused) {
            synth.cancel(); 
            btn.innerText = 'ç»§ç»­';
            document.getElementById('statusMsg').innerText = 'å·²æš‚åœ';
        } else {
            btn.innerText = 'æš‚åœ';
        }
    }

    function stopDictation() {
        isRunning = false;
        synth.cancel();
        document.getElementById('runningArea').style.display = 'none';
        document.getElementById('setupArea').style.display = 'block';
    }

    function finishDictation() {
        document.getElementById('wordDisplay').innerText = "ğŸ‰ å†²åˆºå®Œæˆï¼";
        document.getElementById('statusMsg').innerText = "è€ƒå‰çªå‡»ç»“æŸï¼Œå¿«æ£€æŸ¥é”™åˆ«å­—";
        
        const list = document.getElementById('answerList');
        let html = '<h3>âœ… ç­”æ¡ˆæ ¸å¯¹</h3><div class="answer-grid">';
        currentSessionList.forEach((w, i) => {
            html += `<div class="answer-item"><span style="font-size:0.8em;color:#aaa">${i+1}.</span> <br>${w}</div>`;
        });
        html += '</div>';
        
        list.innerHTML = html;
        list.style.display = 'block';
        document.getElementById('pauseBtn').style.display = 'none';
        
        setTimeout(() => {
            list.scrollIntoView({ behavior: 'smooth' });
        }, 500);
    }

    // --- Extra: PDF Support ---
    async function handlePdfUpload(event) {
        const file = event.target.files[0];
        if (!file) return;
        const statusEl = document.getElementById('ocrStatus');
        statusEl.innerText = 'â³ æ­£åœ¨è§£æ PDF...';
        try {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let fullText = '';
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                fullText += textContent.items.map(item => item.str).join(' ');
            }
            document.getElementById('customWordInput').value = fullText;
            statusEl.innerText = 'âœ… è§£ææˆåŠŸï¼Œè¯·ç‚¹å‡»â€œå¼€å§‹ä»Šæ—¥å†²åˆºâ€';
        } catch (e) {
            statusEl.innerText = 'âŒ è§£æå¤±è´¥';
        }
    }

    function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

</script>

</body>
</html>